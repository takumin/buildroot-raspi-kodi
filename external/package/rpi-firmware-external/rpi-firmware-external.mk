################################################################################
#
# rpi-firmware
#
################################################################################

RPI_FIRMWARE_EXTERNAL_VERSION = 6b37a457122714aa14b2c7df0926455173fd04f1
RPI_FIRMWARE_EXTERNAL_SITE = $(call github,raspberrypi,firmware,$(RPI_FIRMWARE_EXTERNAL_VERSION))
RPI_FIRMWARE_EXTERNAL_LICENSE = BSD-3-Clause
RPI_FIRMWARE_EXTERNAL_LICENSE_FILES = boot/LICENCE.broadcom
RPI_FIRMWARE_EXTERNAL_INSTALL_IMAGES = YES

RPI_FIRMWARE_EXTERNAL_FILES = \
	$(if $(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_BOOTCODE_BIN), bootcode.bin) \
	$(if $(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_VARIANT_PI), start.elf fixup.dat) \
	$(if $(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_VARIANT_PI_X), start_x.elf fixup_x.dat) \
	$(if $(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_VARIANT_PI_CD), start_cd.elf fixup_cd.dat) \
	$(if $(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_VARIANT_PI_DB), start_db.elf fixup_db.dat) \
	$(if $(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_VARIANT_PI4), start4.elf fixup4.dat) \
	$(if $(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_VARIANT_PI4_X), start4x.elf fixup4x.dat) \
	$(if $(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_VARIANT_PI4_CD), start4cd.elf fixup4cd.dat) \
	$(if $(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_VARIANT_PI4_DB), start4db.elf fixup4db.dat)

define RPI_FIRMWARE_EXTERNAL_INSTALL_BIN
	$(foreach f,$(RPI_FIRMWARE_EXTERNAL_FILES), \
		$(INSTALL) -D -m 0644 $(@D)/boot/$(f) $(BINARIES_DIR)/$(f)
	)
endef

RPI_FIRMWARE_EXTERNAL_CONFIG_FILE = $(call qstrip,$(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_CONFIG_FILE))
ifneq ($(RPI_FIRMWARE_EXTERNAL_CONFIG_FILE),)
define RPI_FIRMWARE_EXTERNAL_INSTALL_CONFIG
	$(INSTALL) -D -m 0644 $(RPI_FIRMWARE_EXTERNAL_CONFIG_FILE) \
		$(BINARIES_DIR)/config.txt
endef
endif

RPI_FIRMWARE_EXTERNAL_CMDLINE_FILE = $(call qstrip,$(BR2_PACKAGE_RPI_FIRMWARE_EXTERNAL_CMDLINE_FILE))
ifneq ($(RPI_FIRMWARE_EXTERNAL_CMDLINE_FILE),)
define RPI_FIRMWARE_EXTERNAL_INSTALL_CMDLINE
	$(INSTALL) -D -m 0644 $(RPI_FIRMWARE_EXTERNAL_CMDLINE_FILE) \
		$(BINARIES_DIR)/cmdline.txt
endef
endif

define RPI_FIRMWARE_EXTERNAL_INSTALL_IMAGES_CMDS
	$(RPI_FIRMWARE_EXTERNAL_INSTALL_BIN)
	$(RPI_FIRMWARE_EXTERNAL_INSTALL_CONFIG)
	$(RPI_FIRMWARE_EXTERNAL_INSTALL_CMDLINE)
endef

$(eval $(generic-package))
